---
title: "Happy Moments From Different Age Period"
output:
  html_document:
    df_print: paged
  html_notebook:default html_document:default: default
  word_document: default
---


Happy moments are full of our daily lives, and today we have a chance to dive into a handy dataset that can help shed some light on the fundamentals of happiness.As for me, I am wondering people under different age will have differnet happy moments or not. So I decide to analyze the happymoments of different age groups. I separate the data into four age groups. 

*First group is people whose age is less an 25 years old. They represent young people such as students.*

*Second group is people who are between 25 to 40 years old.They represent people who have been working less for 20 years.*

*Third group is people with age between 40 to 60 years old. Those people have been working for a long time and represent the middleâ€”aged.*

*Fourth group is people whose age is  above 60 years old, they represent the elderly.*

```{r,message=FALSE,echo=FALSE,warning=FALSE}
###Part0: Load libraries and text data; Separate into four groups
library(dplyr)
library(tidytext)
library(ggplot2)
library(wordcloud)
library(tidyr)
library(stringr)
library(scales)
library(syuzhet)
```

```{r,message=FALSE,echo=FALSE,warning=FALSE}
setwd("/Users/Anny/Documents/GitHub/Fall2018-Proj1-xf2168/output")

urlfile<-'https://raw.githubusercontent.com/rit-public/HappyDB/master/happydb/data/demographic.csv'
demo_data <- read.csv(urlfile,as.is=TRUE)

hm_data <- read.csv("../output/processed_moments.csv")
```

```{r combining data, warning=FALSE, message=FALSE,echo=FALSE}
#We use the processed data for our analysis and combine it with the demographic information available.Keep the required columns for analysis
ageframe <- hm_data%>%
  inner_join(demo_data, by = "wid") %>%
  select(wid,
         cleaned_hm,
         age, 
         text) 

ageframe$age= as.numeric(ageframe$age)
ageframe$text= as.character(ageframe$text)
ageframe<-ageframe[-which(is.na(ageframe$age)),]

```

```{r,message=FALSE,echo=FALSE,warning=FALSE}
#We get four groups of data according to different age range
# Group1__age<25
age_below25 <- ageframe%>% 
  filter(age <=25&age>7) %>% 
  select(wid, cleaned_hm,age,text)
#Group2__age(25,40)
age_25to40<- ageframe%>% 
  filter(age <=40 & age>25) %>% 
  select(wid, cleaned_hm,age,text)
#Group3__age(40,60)
age_40to60<-ageframe%>% 
  filter(age >40&age<=60) %>% 
  select(wid, cleaned_hm,age,text)
#Group4__age above 60
age_above60<-ageframe%>% 
  filter(age >60&age<100) %>% 
  select(wid, cleaned_hm,age,text)
```

![](/Users/Anny/Documents/GitHub/Fall2018-Proj1-xf2168/figs/ss.jpg)



###Part 1: How about their happiness in different age groups?
*In order to get some basic characteristics of happymoments from these four groups, the word count and word cloud would be analyzed.*

####Word Count

*Age below 25*
```{r,message=FALSE,echo=FALSE,warning=FALSE}
## age below 25
tidy_below25 <- age_below25 %>%
  unnest_tokens(word, text)

data(stop_words)
tidy_below25 <- tidy_below25 %>%
  anti_join(stop_words)

tidy_below25 %>%
  count(word, sort = TRUE) %>%
  filter(n > 500) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col(color="green") +
  xlab(NULL) +
  coord_flip()
```
*Age between 25 to 40*
```{r,message=FALSE,echo=FALSE,warning=FALSE}
## age between 25 to 40
tidy_25to40 <- age_25to40 %>%
  unnest_tokens(word, text)

data(stop_words)
tidy_25to40 <- tidy_25to40 %>%
  anti_join(stop_words)

tidy_25to40 %>%
  count(word, sort = TRUE) %>%
  filter(n > 1500) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col(color="blue") +
  xlab(NULL) +
  coord_flip()
```
*Age between 40 to 60*
```{r,message=FALSE,echo=FALSE,warning=FALSE}
## age 40 to 60
tidy_40to60 <- age_40to60 %>%
  unnest_tokens(word, text)

data(stop_words)
tidy_40to60 <- tidy_40to60 %>%
  anti_join(stop_words)

tidy_40to60 %>%
  count(word, sort = TRUE) %>%
  filter(n > 250) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col(color="yellow") +
  xlab(NULL) +
  coord_flip()

```
*Age above 60*
```{r,message=FALSE,echo=FALSE,warning=FALSE}
## age above 60
tidy_above60 <- age_above60 %>%
  unnest_tokens(word, text)

data(stop_words)
tidy_above60 <- tidy_above60 %>%
  anti_join(stop_words)

tidy_above60 %>%
  count(word, sort = TRUE) %>%
  filter(n > 50) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col(color="red") +
  xlab(NULL) +
  coord_flip()
```

####Word Cloud

*Age below 25*
```{r,message=FALSE,echo=FALSE,warning=FALSE}
tidy_below25 %>%
  anti_join(stop_words) %>%
  count(word) %>%
  with(wordcloud(word, n, max.words = 100,color="dark green"))
```
*Age between 25 to 40*
```{r,message=FALSE,echo=FALSE,warning=FALSE}
tidy_25to40 %>%
  anti_join(stop_words) %>%
  count(word) %>%
  with(wordcloud(word, n, max.words = 100,color="blue"))
```
*Age between 40 to 65*
```{r,message=FALSE,echo=FALSE,warning=FALSE}
tidy_40to60 %>%
  anti_join(stop_words) %>%
  count(word) %>%
  with(wordcloud(word, n, max.words = 100,color="yellow"))
```
*Age above 60*
```{r,message=FALSE,echo=FALSE,warning=FALSE}
tidy_above60 %>%
  anti_join(stop_words) %>%
  count(word) %>%
  with(wordcloud(word, n, max.words = 100,colors="red"))
```

## SUMMARY1:
We have some interesting moments happened. People experience or focus on different things when they are under different age period. As for young people who study at school, they think friend, family,watch TV,play games, go to events, hang out with girlfriend/boyfriend or go to school/college can make them happy. 

When people graduate from school,start getting a job, and many of them get married. They think friend,family, watch TV, play, son/daughter, husband/wife, and job can make them happy.

When people works for a long time and enter middle age, they feel that family,  friend, son/daughter, wife/husband,watch TV, or have a dinner can make them happy.

After they retired, family,  friend, son/daughter, wife/husband, grandson/granddaughter, dog,watch TV, visit or call someone make them happy most often.

![](/Users/Anny/Documents/GitHub/Fall2018-Proj1-xf2168/figs/hm.png)


###Part2: Do people have same happy moments?
*In this part, I apply word frequences to analyze, and using a correlation test to quantify how similar and different these sets of word frequencies, how correlated are the word frequencies.*

####First Round: Student VS Elderly
```{r,message=FALSE,echo=FALSE,warning=FALSE}
frequency1 <- bind_rows(mutate(tidy_below25, age = "Below25"),
                       mutate(tidy_above60, age = "Above 60")) %>% 
  mutate(word = str_extract(word, "[a-z']+")) %>%
  count(age, word) %>%
  group_by(age) %>%
  mutate(proportion = n / sum(n)) %>% 
  select(-n) %>% 
  spread(age, proportion) %>% 
  gather(age, proportion, `Below25`)

ggplot(frequency1, aes(x = proportion, y = `Above 60`, color = abs(`Above 60` - proportion))) +
  geom_abline(color = "gray40", lty = 2) +
  geom_jitter(alpha = 0.1, size = 2.5, width = 0.3, height = 0.3) +
  geom_text(aes(label = word), check_overlap = TRUE, vjust = 1.5) +
  scale_x_log10(labels = percent_format()) +
  scale_y_log10(labels = percent_format()) +
  scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75") +
  facet_wrap(~age, ncol = 3) +
  theme(legend.position="none") +
  labs(y = "Above 60", x = NULL)

```

Correlation test
```{r,message=FALSE,echo=FALSE,warning=FALSE}
cor.test(data = frequency1[frequency1$age == "Below25",],
         ~ proportion + `Above 60`)
```


####Second Round: Work People VS Retired People
Here I define "work people" with age from 25 years old to 60 years old.
```{r,message=FALSE,echo=FALSE,warning=FALSE}
frequency2 <- bind_rows(mutate(tidy_25to40, age = "Between 25 to 40"),
                        mutate(tidy_40to60, age = "Between 40 to 60"),
                        mutate(tidy_above60, age = "Above 60")) %>% 
  mutate(word = str_extract(word, "[a-z']+")) %>%
  count(age, word) %>%
  group_by(age) %>%
  mutate(proportion = n / sum(n)) %>% 
  select(-n) %>% 
  spread(age, proportion) %>% 
  gather(age, proportion, `Between 25 to 40`:`Between 40 to 60`)

ggplot(frequency2, aes(x = proportion, y = `Above 60`, color = abs(`Above 60` - proportion))) +
  geom_abline(color = "gray40", lty = 2) +
  geom_jitter(alpha = 0.1, size = 2.5, width = 0.3, height = 0.3) +
  geom_text(aes(label = word), check_overlap = TRUE, vjust = 1.5) +
  scale_x_log10(labels = percent_format()) +
  scale_y_log10(labels = percent_format()) +
  scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75") +
  facet_wrap(~age, ncol = 3) +
  theme(legend.position="none") +
  labs(y = "Above 60", x = NULL)
```
Correlation test
```{r,message=FALSE,echo=FALSE,warning=FALSE}
cor.test(data = frequency2[frequency2$age == "Between 25 to 40",],
         ~ proportion + `Above 60`)

cor.test(data = frequency2[frequency2$age == "Between 40 to 60",],
         ~ proportion + `Above 60`)
```

####Third Round: Student VS Work People
```{r,message=FALSE,echo=FALSE,warning=FALSE}
frequency3 <- bind_rows(mutate(tidy_25to40, age = "Between 25 to 40"),
                        mutate(tidy_40to60, age ="Between 40 to 60"),
                        mutate(tidy_below25, age = "Below 25")) %>% 
  mutate(word = str_extract(word, "[a-z']+")) %>%
  count(age, word) %>%
  group_by(age) %>%
  mutate(proportion = n / sum(n)) %>% 
  select(-n) %>% 
  spread(age, proportion) %>% 
  gather(age, proportion, `Between 25 to 40`:`Between 40 to 60`)

ggplot(frequency3, aes(x = proportion, y = `Below 25`, color = abs(`Below 25` - proportion))) +
  geom_abline(color = "gray40", lty = 2) +
  geom_jitter(alpha = 0.1, size = 2.5, width = 0.3, height = 0.3) +
  geom_text(aes(label = word), check_overlap = TRUE, vjust = 1.5) +
  scale_x_log10(labels = percent_format()) +
  scale_y_log10(labels = percent_format()) +
  scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75") +
  facet_wrap(~age, ncol = 3) +
  theme(legend.position="none") +
  labs(y = "Below 25", x = NULL)
```
Correlation test
```{r,message=FALSE,echo=FALSE,warning=FALSE}
cor.test(data = frequency3[frequency3$age == "Between 25 to 40",],
         ~ proportion + `Below 25`)

cor.test(data = frequency3[frequency3$age == "Between 40 to 60",],
         ~ proportion + `Below 25`)
```

####Fourth Round: Freshman Worker VS Senior Worker

Here I define freshman workers such as people who get into work less then 20 years, and senior workers have long working time, normally longer than 20 years.
```{r,message=FALSE,echo=FALSE,warning=FALSE}
frequency4 <- bind_rows(mutate(tidy_25to40, age = "Between 25 to 40"),
                        mutate(tidy_40to60, age ="Between 40 to 60")) %>% 
  mutate(word = str_extract(word, "[a-z']+")) %>%
  count(age, word) %>%
  group_by(age) %>%
  mutate(proportion = n / sum(n)) %>% 
  select(-n) %>% 
  spread(age, proportion) %>% 
  gather(age, proportion, `Between 25 to 40`)

ggplot(frequency4, aes(x = proportion, y = `Between 40 to 60`, color = abs(`Between 40 to 60` - proportion))) +
  geom_abline(color = "gray40", lty = 2) +
  geom_jitter(alpha = 0.1, size = 2.5, width = 0.3, height = 0.3) +
  geom_text(aes(label = word), check_overlap = TRUE, vjust = 1.5) +
  scale_x_log10(labels = percent_format()) +
  scale_y_log10(labels = percent_format()) +
  scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75") +
  facet_wrap(~age, ncol = 3) +
  theme(legend.position="none") +
  labs(y = "Between 40 to 60", x = NULL)
```

Correlation test
```{r,message=FALSE,echo=FALSE,warning=FALSE}
cor.test(data = frequency4[frequency4$age == "Between 25 to 40",],
         ~ proportion + `Between 40 to 60`)
```

##SUMMARY2:
We make a camparison between different age groups to figure out wheater they have same happy moments or not. 

First round,I am interested in comparing people under 25 years old with people whose age is above 60 years old.They have the greatest age difference, and have the lowest correlation.
From the analysis, we can see that they do not have many common happy moments besides family. Lunch, daughter, neighbor, garden/yard, golf, granddaughter can make the elderly happy, but young students think that game, college/class, girlfriend/boyfriend make them happy.


Second round, we can see that no matter work or not, they both feel that daughter,call someone ,buy something can make them happy.Only one thing is different, that is grandchild makes people whose age above 60 years old happy.

Third round, both young student and work people think birthday makes them happy.But work people also feel that son/daughter or even grandchildren  make them happy.


Fourth round, freshman worker and senior worker have many similar happy moments and they have the highest correlation.

Overall,during different age periods, people have different things to feel happy.If age difference is smaller,they have more similar happy moments because the correlation is larger; However there are two things that are important for every age stage, FRIEND and FAMILY/HOME; They make people happy no matter who you are, and no matter how old you are.

![](/Users/Anny/Documents/GitHub/Fall2018-Proj1-xf2168/figs/happiness.jpg)


##Part3: We think that happymoments should all have positive attitude, is it true? 
*Sentiment analysis weighs the emotional intensity of text and I measure the sentiment of happy moments to see how their intensities vary from different age stage. *
```{r,message=FALSE,echo=FALSE,warning=FALSE}
par(mfrow=c(1,5))

# Group1__age<25
text.1 <- gsub("[\\S]*http\\S+", " ", age_below25$cleaned_hm) 
text.1 <- gsub("[^A-z'\"]", " ", text.1)
sentiment.values.1 <- get_sentiment(text.1, method="syuzhet")
summary(sentiment.values.1)
boxplot(sentiment.values.1, ylim=c(-5, 20), main="Age below 25", ylab="Sentiment of Moments")

#Group2__age(25,40)
text.2 <- gsub("[\\S]*http\\S+", " ", age_25to40$cleaned_hm) 
text.2 <- gsub("[^A-z'\"]", " ", text.2)
sentiment.values.2 <- get_sentiment(text.2, method="syuzhet")
summary(sentiment.values.2)
boxplot(sentiment.values.2, ylim=c(-5, 20), main="Age betw 25to40", ylab="Sentiment of Moments")

#Group3__age(40,60)
text.3 <- gsub("[\\S]*http\\S+", " ", age_40to60$cleaned_hm) 
text.3 <- gsub("[^A-z'\"]", " ", text.3)
sentiment.values.3 <- get_sentiment(text.3, method="syuzhet")
summary(sentiment.values.3)
boxplot(sentiment.values.3, ylim=c(-5, 20), main="Age betw 40to60", ylab="Sentiment of Moments")

#Group4__age above 60
text.4 <- gsub("[\\S]*http\\S+", " ", age_above60$cleaned_hm)
text.4 <- gsub("[^A-z'\"]", " ", text.4)
sentiment.values.4 <- get_sentiment(text.4, method="syuzhet")
summary(sentiment.values.4)
boxplot(sentiment.values.4, ylim=c(-5, 20), main="Age above 60", ylab="Sentiment of Moments")

```

##SUMMARY3:
Before doing this sentiment analysis, I am confident that they all should be positive since it is the data about happy moments.However, the result surprised me.

Exactly, overall the moments are definitely positive and the 25th, 50th, and 75th percentiles across age groups are virtually identical. But the bottom quartile does have negative sentiment. I guess the reason is that some happy things may poetically arise from discomfort things.


###Reference:
1.https://www.tidytextmining.com/topicmodeling.html

2.https://medium.freecodecamp.org/a-data-scientists-guide-to-happiness-findings-from-the-happy-experiences-of-10-000-humans-fc02b5c8cbc1










